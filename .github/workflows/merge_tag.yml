name: "Manual: Merge development â†’ master & tag"

permissions: read-all

# checkov:skip=CKV_GHA_7 reason="This workflow needs manual inputs for tagging and merging"
on:
  workflow_dispatch:
    inputs:
      tag_name:
        description: "Tag name to create (e.g. v1.2.3)"
        required: true
      create_tag:
        description: "Create Git tag?"
        required: true
        default: "true"
        type: choice
        options:
          - "true"
          - "false"

jobs:
  merge-and-tag:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: ğŸ”„ Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: âš™ï¸ Configure Git
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"

      - name: ğŸ”€ Merge development into master
        run: |
          git checkout master
          git merge origin/development --no-ff -m "Manual merge from development into master"
          git push origin master

      - name: ğŸ·ï¸ Create Git tag (optional)
        if: ${{ github.event.inputs.create_tag == 'true' }}
        run: |
          git tag -a "${{ github.event.inputs.tag_name }}" -m "Release ${{ github.event.inputs.tag_name }}"
          git push origin "${{ github.event.inputs.tag_name }}"
